<!DOCTYPE html>
<html>
	<head>
		<title>Nastavitev OpenVPN strežnika</title>
		<script src="scripts/jquery.min.js"></script>
		<script src="scripts/bootstrap.min.js"></script>
		<link rel="stylesheet" href="styles/bootstrap.min.css">
	</head>
	<body>
		<div class="container mt-3">
			<h1>Nastavitev OpenVPN strežnika</h1>
			<div class="row mb-3">
				<div class="col-12">
					<div class="card">
						<div class="card-body">
							<p>Pred prvo uporabo je treba strežnik konfigurirati. Vnesite ime domene, na kateri bo OpenVPN strežnik dosegljiv:</p>
							<input type="text" class="form-control mb-3" placeholder="vasa.domena.si" aria-label="Domena" aria-describedby="next-button" id="domain">
							
							<p><b>(DODATNO)</b> Za večjo varnost lahko nastavite geslo za izdajo potrdil. To geslo bo potrebno za dodajanje in brisanje uporabnikov.
							Če ga izgubite, boste morali strežnik ponastaviti in vsi uporabniki bodo izbrisani. Pustite prazno za izdajo potrdil
							brez gesla.</p>
							<input type="password" class="form-control mb-3" placeholder="Geslo za potrdila" id="ca-password">
							
							<div class="text-center md-3">
								<button class="btn btn-primary" type="button" id="next-button">Naprej</button>
							</div>
							
							<div id="loading-div" class="text-center" style="display: none;">
								<div class="spinner-border text-primary m-3" role="status">
									<span class="sr-only">Loading...</span>
								</div>
								<p>Strežnik se pripravlja za prvo uporabo. <br>
								(To lahko traja nekaj časa.)</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			window.addEventListener('load', function() {
				domain = document.getElementById('domain');		
				caPass = document.getElementById('ca-password');
				spinnerDiv = document.getElementById('loading-div');
				nextButton = document.getElementById('next-button');
				
				nextButton.addEventListener('click', setupServer);
			});
			
			let invalidDomain = new RegExp("[^a-z0-9-.]","i");
			
			function setupServer() {
				if (!invalidDomain.test(domain.value)) {
					spinnerDiv.style.display = '';
					$.get('/setupServer?domain=' + domain.value + '&capass=' + caPass.value, function(data) {
						window.location.reload();
					}).fail(function() {
						window.location.reload();
					});
				} else {
					alert("Neveljavno ime domene!");
				}
			}
		</script>
	</body>
</html>