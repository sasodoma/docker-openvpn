<!DOCTYPE html>
<html>
	<head>
		<script src="scripts/jquery.min.js"></script>
		<script src="scripts/bootstrap.min.js"></script>
		<link rel="stylesheet" href="styles/bootstrap.min.css">
	</head>
	<body>
		<div class="container mt-3">
			<h1>Nastavitev OpenVPN strežnika</h1>
			<div class="row mb-3">
				<div class="col-12">
					<div class="card">
						<div class="card-body">
							<p>Pred prvo uporabo je treba strežnik konfigurirati. Vnesite ime domene, na kateri bo OpenVPN strežnik dosegljiv:</p>
							<div class="input-group mb-3">
								<input type="text" class="form-control" placeholder="vasa.domena.si" aria-label="Domena" aria-describedby="next-button" id="domain">
								<div class="input-group-append">
									<button class="btn btn-primary" type="button" id="next-button">Naprej</button>
								</div>
							</div>
							<div id="loading-div" class="text-center" style="display: none;">
								<div class="spinner-border text-primary m-3" role="status">
									<span class="sr-only">Loading...</span>
								</div>
								<p>Strežnik se pripravlja za prvo uporabo. <br>
								(To lahko traja nekaj časa.)</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			window.addEventListener('load', function() {
				domain = document.getElementById('domain');				
				spinnerDiv = document.getElementById('loading-div');
				nextButton = document.getElementById('next-button');
				
				nextButton.addEventListener('click', setupServer);
			});
			
			let invalidDomain = new RegExp("[^a-z0-9-.]","i");
			
			function setupServer() {
				if (!invalidDomain.test(domain.value)) {
					spinnerDiv.style.display = '';
					$.get('/setupServer?domain=' + domain.value, function(data) {
						window.location.reload();
					}).fail(function() {
						window.location.reload();
					});
				} else {
					alert("Neveljavno ime domene!");
				}
			}
		</script>
	</body>
</html>